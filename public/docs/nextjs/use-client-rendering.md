# Next.js App Router: "use client" とレンダリング・SEO・ハイドレーションの完全まとめ

## 1. "use client" の本質的な意味

### 境界線の宣言
`"use client"` は、そのファイル（およびそこからインポートされるコンポーネント）が「ブラウザでのJavaScript実行を必要とする領域」であることをコンパイラに伝える印。

### 誤解の解消
`"use client"` を付けても、サーバー側で初期HTMLは生成される。つまり「クライアントサイド専用（HTMLが空）」になるわけではない。

## 2. SEO と初期表示（SSR）

### HTMLの生成
`"use client"` コンポーネントであっても、最初の表示に必要なテキスト情報などはサーバー側でHTMLとして生成される。

### SEOの有効性
クローラはHTMLを読み取るため、重要なテキスト情報が `"use client"` 内にあっても、基本的には検索エンジンにインデックスされる。

### 注意点
ただし、JavaScriptのサイズが大きすぎると、クローラの処理効率や表示パフォーマンス（Core Web Vitals）に悪影響を及ぼし、間接的にSEO評価を下げる可能性がある。

## 3. "use client" 多用のデメリット

### JSサイズの増大
サーバーコンポーネントはブラウザにJSを送らないが、クライアントコンポーネントはロジックすべてをブラウザへ送るため、ファイルサイズが増える。

### ビルド時間の増加
クライアントサイド向けのコード分割（Code Splitting）や最適化のプロセスが増える。

### ハイドレーションコスト
ブラウザが実行すべきJSが増え、CPU負荷が高まる。

## 4. ハイドレーションと useEffect の関係

### ハイドレーション（Hydration）とは
「サーバーが作った静的な彫刻（HTML）」に「Reactという魂（JSのロジック）」を紐付ける作業。見えない処理だが、ブラウザのメインスレッドを占有する重い処理になることがある。

`useState` や `useEffect` の基本的な使い方については、[React Hooks（フック）](../react/hooks.md) を参照してください。

### useEffect の実行タイミング

#### 開始の遅延
`useEffect` は、JSのダウンロード → 解析 → ハイドレーション（DOMとの紐付け）が完了し、Reactが「マウントされた」と確信した後に初めて実行される。

#### 依存関係
JSサイズが大きくハイドレーションに時間がかかるほど、`useEffect` が動き出すタイミングは後ろにズレる。

#### 視覚的影響
HTMLが見えているのに、`useEffect` による初期化（アニメーションやデータ取得）が始まらない「見た目だけあるが動かない時間」が発生する。

## 5. 最適な設計戦略（正直な意見）

### 迷ったらサーバーコンポーネント
原則として `"use client"` は付けず、サーバー側でデータを取得・表示する。

### 最小限の適用
`"use client"` は、`useState` や `useEffect`、イベントリスナー（onClick等）が必要な「末端のコンポーネント（リーフ）」にだけ適用するのがベスト。

### 脱 useEffect
データの取得などはサーバーコンポーネントの `async/await` で行うことで、ハイドレーション待ちによる表示のガタつき（レイアウトシフト）を防ぐことができる。

